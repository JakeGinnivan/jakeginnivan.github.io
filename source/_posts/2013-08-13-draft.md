---
layout: post
title: VSTO Contrib
metaTitle: VSTO Contrib
description: 
revised: 2013-08-13
date: 2013-08-13
categories: [vsto-contrib]
migrated: true
comments: true
sharing: true
footer: true
permalink: /vsto-contrib/draft/
summary: | 
  

---
This is a guest post from Jake Ginnivan, author of an open source framework built on top of VSTO called VSTO Contrib. 

VSTO Contrib is a library which enables unit testing, Inversion of Contrib, Convention over Configuration and many other things developers have come to love when writing software. The other thing that VSTO Contrib does is remove many of the common pains that are felt when writing add-ins, like registering custom task panes with new windows automatically, sychronising a custom task pane with a ribbon button, and all ribbon callbacks being in a single file.

In this post we will be going through a few of the main features of VSTO Contrib, and help you gain an understanding of whether VSTO Contrib will be helpful to you. One thing to note is VSTO Contrib only works when using Ribbon XML, you cannot use the VSTO Designer when using VSTO Contrib.

## Simplifying window management
When it comes to an office application, it is made up of a few different parts. The Ribbon, the window, the current document/item/spreadsheet and custom task panes are the main ones. Each of these things is managed separately, here is a breakdown of how we interact with each of these things

### Ribbon
When extending the ribbon, we have two options

1. Use the VSTO Designer
    - Allows you to have a class for each ribbon type that you are extending
    - Can easily define your ribbon customisations, and use standard .net events and properties to interact with the ribbon controls
    - Discoverable, because you are dealing with .net properties and events, you do not need to know callback method signatures etc.
1. Use Ribbon Xml
    - You provide a single instance of a class inheriting from IRibbonExtentibility
    - All callbacks, no matter how many different ribbon types you are extending are defined in that single class.
    - Powerful and Flexible
    - Your IRibbonExtensibility implementation has to return the xml for a specific ribbon type when Office asks for it

As mentioned above VSTO Contrib works with ribbon xml, but makes it better, and closes many gaps between the VSTO Designer and Ribbon xml. It even is better than the Designer in a few things

 - You create a callback file for each ribbon you are creating
 - VSTO Contrib will create an instance of your callback class for EACH Document/Spreadsheet/Item etc.
     - This instance will know what document it is related to, this means that ribbon xml is now stateful, this is one of the biggest advantages of using the designer over ribbon xml
 - Your callback file can be created by an IoC container, allowing dependency injection
 - Callbacks can now be properties
     - For instance, if I have a checkbox, `getPressed` and `onAction` can both be set to `CheckboxValue`, when onAction is invoked the setter of your property will be called. When `getPressed` is invoked, the getter of your property will be called
     - Properties support the INotifyPropertyChanged interface, when the PropertyChanged event is raised, that ribbon control is invalidated automatically!
 - Your ribbon callback class simply has to be named the same as the ribbon xml file, and it will be discovered *via convention*, so you don't have to read embedded resources and return them to Office.
 - Easy to define what type of ribbon your callback file is for, simply use an attribute  
`[OutlookRibbonViewModel(OutlookRibbonType.OutlookContact)]`

Pretty awesome?

### Window
Window management in office applications is interesting, there are many subtleties. Lets take Excel.

Excel 2010 used a MDI (Multiple Document Interface), and 2013 uses an SDI (Single Document Interface), depending on what you are doing you have to handle scenarios where the user has 2 documents open, then 2 windows showing the same document, meaning you have 3 windows for 2 documents. For many add-ins this won't affect you, but when it does VSTO Contrib is there to help.

The callbacks file we were talking about in the Ribbons section, in VSTO Contrib it is called the `RibbonViewModel`, the View Model is notified every time the user changes the window showing a document with a property called `object CurrentView { get; set; }`

This means the current window for the document in question is always handy!

### Custom Task Panes
Custom task panes are great, they allow you to really add value to the office applications by exposing context sensitive information about what they are doing at the moment.

VSTO makes working with Custom Task Panes very easy, all you have to do is in your ThisAddin class, just call `CustomTaskPaneCollection.Add(new UserControl(), "Custom Task Pane Title")`.

The pain comes when the user opens a second document, you then have to make sure you handle the event for new document, then register another custom task pane. These problems are not hard to solve, but it is more code you have to write before things work properly.

In VSTO Contrib, if you want to create a custom task pane, all you have to do is make your View Model inherit from `IRegisterCustomTaskPane`, which looks like this

    /// <summary>
    /// Notifies VSTO Contrib that your viewmodel wants to register a custom task pane
    /// </summary>
    public interface IRegisterCustomTaskPane
    {
        /// <summary>
        /// Injection method giving the view model a chance to register task pane(s) with the view
        /// </summary>
        /// <param name="register">The register.</param>
        void RegisterTaskPanes(Register register);
    }

    /// <summary>
    /// Allows the registration of custom task pane(s)
    /// </summary>
    public delegate ICustomTaskPaneWrapper Register(Func<UserControl> controlFactory, string title);

When you implement this interface, all you have to do is invoke the `register` delegate, like so:

    public void RegisterTaskPanes(Register register)
    {
        register(() => new TwitterFeedControl(), "Twitter");
    }

This looks very similar to adding a custom task pane to the register, except we are passing a lambda which creates the User Control. This is so VSTO contrib can call your lambda every time the user opens a new window, then that user control will be used to register a new custom task pane for that window.

The Register delegate also returns a `ICustomTaskPaneWrapper` which wraps all of the custom task panes that VSTO Contrib is managing for you. So if you set `customTaskPane.Visible = false;` on the `ICustomTaskPaneWrapper` and the user has two windows open, Visible will be set to false for the custom task pane on both windows! 

## Unit Testing
I mentioned unit testing before. There are a few things which enable unit testing.

The first is VSTO Contrib lets you put your Ribbon View Models in any class library, the second is you can use dependency injection on your View Models. The combination of these two things means you can easily unit test the logic inside your viewmodels.
If done correctly, the add-in project will only have the `ThisAddin` class in it, everything else will be in a separate, unit tested class library.

## Getting started
It is pretty easy to get started with VSTO Contrib, it currently supports Office 2010 and Office 2013 only. If you need 2007 support raise an issue (details at the end), and it might get introduced.

### 1. Install relevant package from NuGet

    PM> Install-Package VSTOContrib.Outlook
    PM> Install-Package VSTOContrib.Word
    PM> Install-Package VSTOContrib.Excel
    PM> Install-Package VSTOContrib.PowerPoint

### 2. Follow instructions in readme.txt which will pops up when you install the package.
There are 4 simple steps (just copy and paste some code) into the relevant places, if you have used VSTO Contrib in the past, the last release made this a lot easier!

### 3. Create a ribbon view model
1. Create a class which inherits from `IRibbonViewModel`
1. If you are using outlook, decorate the class with the `OutlookRibbonViewModel` attribute to select the ribbon this View Model is extending.

### 4. Create the ribbon xml
The ribbon xml should be named the same as the ribbon view model, even if your add-in doesn't extend the ribbon you can still take advantage of the ribbon view model, but it does require a ribbon xml file to exist.

## Summary
VSTO Contrib is a project which has slowly evolved, if it looks useful to you, try it out! Here are some links relating to the project you may be interested in

Project Page - [https://github.com/JakeGinnivan/VSTOContrib](https://github.com/JakeGinnivan/VSTOContrib)  
Report an Issue - [https://github.com/JakeGinnivan/VSTOContrib/issues](https://github.com/JakeGinnivan/VSTOContrib/issues)  
VSTO Ribbon Factory in depth - [http://jake.ginnivan.net/vsto-contrib/ribbon-factory](http://jake.ginnivan.net/vsto-contrib/ribbon-factory)  
Introduction to VSTO Contrib Blog Post - [http://jake.ginnivan.net/vsto-contrib/introduction](http://jake.ginnivan.net/vsto-contrib/introduction)

Feedback and bug reports are very welcome