
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>UI TDD - UI Automation Experiment - Jake Ginnivan's blog</title>
  <meta name="author" content="Jake Ginnivan">

  
  <meta name="description" content="After using UI automation in a project which went live yesterday, I wanted to try UI TDD with my lessons learnt. This is the story.">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://JakeGinnivan.github.io/uitdd">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Jake Ginnivan's blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-42948513-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Jake Ginnivan's blog</a></h1>
  
    <h2>Things I find useful</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:JakeGinnivan.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">UI TDD - UI Automation Experiment</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-07-12T00:00:00+01:00" pubdate data-updated="true">Jul 12<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Yesterday the project I have been working on for close to a year now went live! We have had very minimal issues and apart from working with an Amazing team of Readify people we have made use of an extensive suite of UI Automation and Integration tests.</p>

<p>Our UI Automation suite was originally supposed to simply be &lsquo;Smoke Tests&rsquo; which run through all UI processes in our application and makes sure it works end to end, not really asserting much, just that the process worked and the expected result was there at the end.</p>

<p>This grew&hellip; we now verify all application logs, have helpers which wait for our message processors to send and receive all messages, then assert everything from audit messages, to financial movements to report data. It has given us amazing confidence in our product and allowed us to go live with maybe a dozen medium priority bugs which has taken us &frac12; a day to get on top of.</p>

<p>I have started breaking out the framework we built into a CodedUI contrib project which lives in the MSTestContrib project on codeplex (<a href="http://mstestcontrib.codeplex.com">http://mstestcontrib.codeplex.com</a>)</p>

<p>I will be creating a WPF Todo application using the framework, writing my UI Automation tests first, refactoring, making mistakes, improving the code etc. It will be the first time I have used EF, so this whole thing will be a learning experience.</p>

<!-- more -->


<h1>Ready&hellip; Go</h1>

<p>For the purposes of the demo app, I will simply have an in memory repository. We can always add proper persistence and such later.</p>

<p>With that basic criteria in mind off I go, I start with two project, WpfTodo, and WpfTodo.Tests.</p>

<p><img src="/assets/posts/2011-07-12-uitdd/UITddStart.PNG" alt="Start" /></p>

<p>and I want to build something like this:</p>

<p><img src="/assets/posts/2011-07-12-uitdd/TodoList.png" alt="My Awesome App" /></p>

<p>Now I add my first CodedUI test (to add all references and such).</p>

<p><img src="/assets/posts/2011-07-12-uitdd/NewCodedUI.png" alt="Add new coded UI Test" /></p>

<p>And then I will cancel out of the generate code dialogue because I want to lovingly craft all my UI Automation code so I don&rsquo;t get bitten when trying to maintain it..</p>

<p><img src="/assets/posts/2011-07-12-uitdd/GenerateCodeForTest.png" alt="Generate Code? Nope!" /></p>

<p>After getting rid of all the generated crap, we are left with:</p>

<pre><code>using Microsoft.VisualStudio.TestTools.UITesting;
using Microsoft.VisualStudio.TestTools.UnitTesting;

namespace WpfTodo.Tests
{
    [CodedUITest]
    public class CodedUITest1
    {
        [TestMethod]
        public void CodedUITestMethod1()
        {

        }
    }
}
</code></pre>

<h1>Some Setup</h1>

<p>Now that we have the CodedUI assemblies referenced it is time to set everything up.</p>

<p><code>NOTE:</code> If you have resharper, disable shadow copy on unit tests otherwise it makes it pretty hard to run your tests locally.</p>

<p>We start off defining our application, this is a nice bootstrapper to abstract starting our app and handling shutdown. You should use Name, then the name will be the window title.</p>

<pre><code>public class TodoApp : WpfApplicationBase
{
    protected override WpfWindow GetMainWindow()
    {
        return new WpfWindow
                    {
                        SearchProperties =
                            {
                                {UITestControl.PropertyNames.Name, "Wpf Todo List"}
                            },
                        TechnologyName = "UIA"
                    };
    }

    protected override string ApplicationExeLocation
    {
        get { return Path.Combine(Path.GetDirectoryName(Assembly.GetExecutingAssembly().Location), "WpfTodo.exe"); }
    }
}
</code></pre>

<p>Now we have our application bootstrapper, we define our CodedUITestBase class which all our tests will inherit from!</p>

<pre><code>public class CodedUITestBase : CodedUITestBase&lt;TodoApp&gt;
{
}
</code></pre>

<p>Notice that we are inheriting from <code>CodedUITestBase&lt;T&gt; where T : ICodedUIApplication, new()</code></p>

<p>It is the job of CodedUITestBase to bootstrap your application. The reason we create your own is so you can extend it.</p>

<p>One more thing is if you use the r# test runner, make sure you compile your test project as x86 otherwise I have found things go a bit strange.</p>

<h1>Writing our first test!</h1>

<p>When using mstestcontrib to write Coded UI Tests (CUIT&rsquo;s) our tests will always start with a screen.</p>

<p>If you do not have ReSharper, then skip down to the code</p>

<p><img src="/assets/posts/2011-07-12-uitdd/CreateMainScreen.png" alt="Main Screen" /></p>

<p><img src="/assets/posts/2011-07-12-uitdd/CreateMainScreenClass.PNG" alt="Create Main Screen Class" /></p>

<p><img src="/assets/posts/2011-07-12-uitdd/GenerateMainScreenCtor.PNG" alt="Generate Main Screen Ctor" /></p>

<pre><code>protected MainScreen MainScreen()
{
    return new MainScreen(Application, Application.MainWindow);
}

public class MainScreen : WpfScreen
{
    public MainScreen(WpfApplicationBase application, WpfWindow window) : base(application, window)
    {
    }
}
</code></pre>

<p>Now move (<code>ctrl + r, ctrl + o</code>) the screen into a Screens directory.</p>

<p>Next we start building our screens up. I want to add a task, it is an action I perform on my main screen, so I will add a method with a few parameters which will end up creating my task for me.</p>

<pre><code>    [TestMethod]
    public void CodedUITestMethod1()
    {
        var mainScreen = MainScreen();

        var newTaskScreen = mainScreen.NewTask();
    }
</code></pre>

<p>Get R# or visual studio do generate that method on your MainScreen class, then we can start writing some UI Automation!</p>

<pre><code>public NewTaskScreen NewTask()
{
    var addTaskButton = Window.Get&lt;WpfButton&gt;("AddTaskButton");
    addTaskButton.Click();

    return new NewTaskScreen(Application, Window.GetWindow("AddTask"));
}
</code></pre>

<p>There is a few things you may notice with this, I am using a Get<T> extension method on my WPF window, I feel this is a cleaner syntax than the out of the box syntax with CodedUI.
Click is also an extension method (I think it reads better than <code>Mouse.Click(addTaskButton);</code>)</p>

<p>We then return a NewTaskScreen, in the second parameter we find the child/modal window and pass it into the screen.</p>

<p>After a little bit more coding our test looks like this</p>

<pre><code>[TestMethod]
public void CodedUITestMethod1()
{
    var mainScreen = MainScreen();
    var newTaskScreen = mainScreen.NewTask();

    newTaskScreen.Title = "Write some tests";
    newTaskScreen.Description = "for MSTestContrib";
    newTaskScreen.DueDate = DateTime.Now.AddDays(3);

    newTaskScreen.Create();
}
</code></pre>

<h1>Run the test</h1>

<p>Obviously our test will fail, we have not created any UI yet, only our UI Automation Test.</p>

<p>Test method WpfTodo.Tests.CanAddTaskTest.CodedUITestMethod1 threw exception:
Microsoft.VisualStudio.TestTools.UITest.Extension.UITestControlNotFoundException: The playback failed to find the control with the given search properties. Additional Details:
TechnologyName:  &lsquo;UIA&rsquo;
ControlType:  &lsquo;Button&rsquo;
AutomationId:  &lsquo;AddTaskButton&rsquo;</p>

<p>So, lets create the UI making sure that we AutomationIds to the controls as we go so they will be picked up by the test we have written. I won&rsquo;t post all the code as you can get at this sample in the MsTestContrib project on codeplex.</p>

<pre><code>&lt;Window x:Class="WpfTodo.View.NewTaskWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="New Task"
        Height="300"
        Width="300"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:ViewModel="clr-namespace:WpfTodo.ViewModel"
        mc:Ignorable="d"
        d:DataContext="{d:DesignInstance ViewModel:NewTaskViewModel}"&gt;
    &lt;Grid&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height="Auto" /&gt;
            &lt;RowDefinition Height="Auto" /&gt;
            &lt;RowDefinition Height="Auto" /&gt;
            &lt;RowDefinition Height="Auto" /&gt;
            &lt;RowDefinition Height="*" /&gt;
        &lt;/Grid.RowDefinitions&gt;
        &lt;Grid.ColumnDefinitions&gt;
            &lt;ColumnDefinition Width="Auto" /&gt;
            &lt;ColumnDefinition Width="*" /&gt;
        &lt;/Grid.ColumnDefinitions&gt;

        &lt;Label Content="Title: " /&gt;
        &lt;TextBox Text="{Binding Task.Title}"
                 AutomationProperties.AutomationId="Title"
                 Grid.Column="1" /&gt;

        &lt;Label Content="Description: "
               Grid.Row="1" /&gt;
        &lt;TextBox Text="{Binding Task.Description}"
                 AutomationProperties.AutomationId="Description"
                 Grid.Column="1"
                 Grid.Row="1" /&gt;

        &lt;Label Content="Due Date: "
               Grid.Row="2" /&gt;
        &lt;DatePicker SelectedDate="{Binding Task.DueDate}"
                    AutomationProperties.AutomationId="DueDate"
                    Grid.Column="1"
                    Grid.Row="2" /&gt;

        &lt;StackPanel Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Grid.ColumnSpan="2"
                    Grid.Row="3"&gt;
            &lt;Button Content="Create"
                    AutomationProperties.AutomationId="CreateButton"
                    Command="{Binding CreateTaskCommand}" /&gt;
            &lt;Button Content="Cancel"
                    AutomationProperties.AutomationId="CancelButton"
                    Command="{Binding CancelCommand}" /&gt;
        &lt;/StackPanel&gt;
    &lt;/Grid&gt;
&lt;/Window&gt;
</code></pre>

<p>Which looks like this (I will make pretty later:P)</p>

<p><img src="/assets/posts/2011-07-12-uitdd/NewTask.png" alt="New Task Window" /></p>

<p>Lets run our test:</p>

<p><img src="/assets/posts/2011-07-12-uitdd/TodoAppTestResult.PNG" alt="Test Results" /></p>

<p>Awesome! It has automated our app, and put a task in. The test is still not much use as we are not verifying that our app is actually working. To verify we start off extending out test.</p>

<pre><code>var tasks = mainScreen.Tasks.ToList();
Assert.AreEqual(1, tasks.Count);
Assert.AreEqual(title, tasks[0].Title);
</code></pre>

<p>Notice we have abstracted the UI of the lists behind a Tasks collection. Which you can see how the UI is put together below.</p>

<p>One thing to point out is you MUST use a Label not a TextBlock, because the TextBlock has no Automation Peer, and is not discoverable by UIA. ItemsControls also suffer from the same issue.</p>

<p>I will post the source for a UITextBlock control which is a TextBlock with an Automation Peer which allows much nicer formatting. But for now, Label&rsquo;s will do.</p>

<pre><code>&lt;ListBox ItemsSource="{Binding Tasks}"
                AutomationProperties.AutomationId="TasksList"
                Grid.Row="1"&gt;
    &lt;ListBox.ItemTemplate&gt;
        &lt;DataTemplate&gt;
            &lt;StackPanel&gt;
                &lt;StackPanel Orientation="Horizontal"&gt;
                    &lt;Label Content="{Binding Title}"
                           AutomationProperties.AutomationId="Title" /&gt;
                    &lt;Label Content=" (" /&gt;
                    &lt;Label Content="{Binding DueDate, StringFormat=d}"
                           AutomationProperties.AutomationId="DueDate" /&gt;
                    &lt;Label Content=")" /&gt;
                &lt;/StackPanel&gt;
                &lt;Label Content="{Binding Description}"
                       AutomationProperties.AutomationId="Description" /&gt;
            &lt;/StackPanel&gt;
        &lt;/DataTemplate&gt;
    &lt;/ListBox.ItemTemplate&gt;
&lt;/ListBox&gt;
</code></pre>

<p>And finally we fill in the UI Automation code for the Tasks property on MainScreen.</p>

<pre><code>public IEnumerable&lt;Task&gt; Tasks
{
    get
    {
        var tasks = Window.Get&lt;WpfList&gt;("TasksList");
        return from WpfListItem item in tasks.Items
                select new Task
                            {
                                Title = item.Get&lt;WpfText&gt;("Title").DisplayText,
                                Description = item.Get&lt;WpfText&gt;("Description").DisplayText,
                                DueDate = DateTime.Parse(item.Get&lt;WpfText&gt;("DueDate").DisplayText)
                            };
    }
}
</code></pre>

<p>Run our test again, success!</p>

<h1>Resources &amp; Source Code</h1>

<p>The sample project I built in this post is available from the <a href="http://mstestcontrib.codeplex.com/SourceControl/list/changesets">MSTestContrib</a> project on CodePlex.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Jake Ginnivan</span></span>

      








  


<time datetime="2011-07-12T00:00:00+01:00" pubdate data-updated="true">Jul 12<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/open-source/'>open-source</a>, <a class='category' href='/blog/categories/ui-automation/'>ui-automation</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://JakeGinnivan.github.io/uitdd/" data-via="JakeGinnivan" data-counturl="http://JakeGinnivan.github.io/uitdd/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/dddsydney/" title="Previous Post: DDD Sydney - Rich Client Automation">&laquo; DDD Sydney - Rich Client Automation</a>
      
      
        <a class="basic-alignment right" href="/clickonce-bootstrapping-errors/" title="Next Post: ClickOnce Bootstrapping Errors">ClickOnce Bootstrapping Errors &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/gitreleasenotes/">GitReleaseNotes Initial Release!</a>
      </li>
    
      <li class="post">
        <a href="/git-flow-versioning/">Git Flow Versioning</a>
      </li>
    
      <li class="post">
        <a href="/release-nuget-semver-packages-from-teamcity/">Release NuGet SemVer Packages From Teamcity</a>
      </li>
    
      <li class="post">
        <a href="/conventiontests-v2-released/">Convention Tests V2 Released</a>
      </li>
    
      <li class="post">
        <a href="/pack-uri-in-unit-tests/">Pack URI in Unit Tests</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/JakeGinnivan">@JakeGinnivan</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'JakeGinnivan',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Jake Ginnivan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'jakeginnivansblog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://JakeGinnivan.github.io/uitdd/';
        var disqus_url = 'http://JakeGinnivan.github.io/uitdd/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
